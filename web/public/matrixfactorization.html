<!DOCTYPE html>
<html class="gr__getbootstrap_com" lang="en">
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="https://getbootstrap.com/favicon.ico">
        <title>Spotify MQP - Matrix Factorization Graph</title>

        <!-- CSS -->
        <link href="/css/bootstrap.css" rel="stylesheet">
        <link href="/css/starter-template.css" rel="stylesheet">
        <style>#content > #right > .dose > .dosesingle,#content > #center > .dose > .dosesingle{display:none !important;}</style>
    </head>
    <style>
    /*HTML Vertical Lengend*/
    h3 {margin-top: 15px;}
    .data-name {margin: 0 !important;}
    .key-dot {
        display: inline-block;
        height: 10px;
        margin-right: .5em;
        width: 10px;
    }
    .legend {margin-right:20px;}
    .mf { background: #4682B4;}
    .feat_mf { background: #FF0000;}

    body {
      background-color: #F1F3F3
    }
    .axis {
    	font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #D4D8DA;
      stroke-width: 2px;
      shape-rendering: crispEdges;
    }

    .line {
      fill: none;
      stroke: #6F257F;
      stroke-width: 5px;
    }

    .overlay {
      fill: none;
      pointer-events: all;
    }

    .focus circle {
      fill: #6F257F;
      stroke: #6F257F;
      stroke-width: 3px;
    }

    .hover-line {
      stroke: #6F257F;
      stroke-width: 2px;
      stroke-dasharray: 3,3;
    }

    .mf_val {
    }
    </style>
    <body data-gr-c-s-loaded="true">
        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
            <a class="navbar-brand" href="#">Spotify Playlist Continuation MQP</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Graphs</a>
                        <div class="dropdown-menu" aria-labelledby="dropdown01">
                            <a class="dropdown-item" href="#">Matrix Factorization Precision</a>
                            <a class="dropdown-item" href="#">Graph 2</a>
                            <a class="dropdown-item" href="#">Graph 3</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>

        <main role="main" class="container">
            <div class="starter-template">
                <h1>Matrix Factorization Precision Graph</h1>
                <div class="legend1">
                  <h3>Legend</h3>
                      <div class="legend1"> <p class="data-name"><span class="key-dot mf"></span>Matrix Factorization</p> </div>
                      <div class="legend1"> <p class="data-name"><span class="key-dot feat_mf"></span>Feature Matrix Factorization</p> </div>
                </div>
                <svg id="MatrixGraph" width="1000" height="600" align="center"></svg>
                <br>

                <script type="text/javascript">
                    // d3.select("#MatrixGraph").select("svg").remove();
                    // Set the dimensions of the canvas / MatrixGraph
                    var svg = d3.select("svg"),
                        margin = {top: 50, right: 20, bottom: 40, left: 50},
                        width = +svg.attr("width") - margin.left - margin.right,
                        height = +svg.attr("height") - margin.top - margin.bottom;


                    var x = d3.scaleLinear().range([0, width]).nice();
                    var y = d3.scaleLinear().range([height, 0]).nice();

                    // Define the line
                    var valueline = d3.line()
                        .x(function(data) { return x(data.n); })
                        .y(function(data) { console.log(data.ndcg.slice(0, 7)); return y(data.ndcg.slice(0, 7)); });

                    var valueline2 = d3.line()
                        .x(function(data) { return x(data.n); })
                        .y(function(data) { console.log(data.ndcg_feat.slice(0, 7)); return y(data.ndcg_feat.slice(0, 7)); });

                    // Adds the svg canvas
                    var svg = d3.select("body").select("#MatrixGraph")
                        .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                    d3.csv("/data/masterSheet.csv", function(data) {
                        var formatter = d3.format(".1");
                        var xAxis = d3.axisBottom().scale(x);
                        var yAxis = d3.axisLeft().scale(y).tickFormat(formatter);

                        data.forEach(function(d) {
                            d.n = d.n;
                            d.ndcg = d.ndcg;
                        });

                        // console.log(data)
                        var min = Math.min(d3.min(data, function(data){ return data.ndcg; }), d3.min(data, function(data) { return data.ndcg_feat; }));
                        var max = Math.max(d3.max(data, function(data){ return data.ndcg; }), d3.max(data, function(data){return data.ndcg_feat;}));
                        var buffer = 0.025;

                        // Scale the range of the data
                        x.domain(d3.extent(data, function(data) { return data.n; }));
                        y.domain([min-buffer, max+buffer]);

                        // Add the X Axis
                        svg.append("g")
                            .attr("class", "axis")
                            .attr("transform", "translate(0," + height + ")")
                            // .style("text-anchor", "middle")
                            // .attr("dx", "-.1em")
                            .call(d3.axisBottom(x)
                                .ticks(25))
                            .append("text")
                            .attr("x", width/2)
                            .attr("y", 35)
                            .attr("dx", "0.71em")
                            .attr("fill", "#000")
                            .attr("text-anchor", "start")
                            .style("font-weight", "bold")
                            .text("K Value");;

                        // Add the Y Axis
                        svg.append("g")
                            .attr("class", "axis")
                            .call(d3.axisLeft(y)
                                .ticks(20))
                            .append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("x", -250)
                            .attr("y", -50)
                            .attr("dy", "0.71em")
                            .attr("fill", "#000")
                            .attr("text-anchor", "start")
                            .style("font-weight", "bold")
                            .text("NDCG Precision");

                        // Add the valueline path.
                        svg.append("path")
                            .data(data)
                            .style("fill", "none")
                            .style("stroke", "steelblue")
                            .style("stroke-width", 3)
                            .attr("class", "line")
                            .attr("d", valueline(data));

                        svg.append("path")
                            .data(data)
                            .style("fill", "none")
                            .style("stroke", "red")
                            .style("stroke-width", 3)
                            .attr("class", "line")
                            .attr("d", valueline2(data));

                        var focus = svg.append("g")
                            .attr("class", "focus")
                            .style("display", "none");

                        focus.append("line")
                            .attr("class", "x-hover-line hover-line")
                            .attr("y1", 0)
                            .attr("y2", height);

                        // focus.append("line")
                        //     .attr("class", "y-hover-line hover-line")
                        //     .attr("x1", width);
                        //
                        // focus.append("line")
                        //     .attr("class", "y-hover-line2 hover-line")
                        //     .attr("y1", 0)
                        //     .attr("x1", width)
                        //     .attr("y2", height);

                        focus.append("text")
                            .attr("class", "mf_val")
                            .attr("x", 5)
                            .attr("y", -30)
                            .attr("dy", ".31em")
                            .text(1);

                        focus.append("text")
                            .attr("class", "mf_feat_val")
                            .attr("x", 5)
                            .attr("y", -10)
                            .attr("dy", ".31em")
                            .text(1);

                        focus.append("text")
                            .attr("class", "n_val")
                            .attr("x", 5)
                            .attr("y", -50)
                            .attr("dy", ".31em")
                            .text(1);

                        svg.append("rect")
                            .attr("transform", "translate(0,0)")
                            .attr("class", "overlay")
                            .attr("width", width)
                            .attr("height", height)
                            .on("mouseover", function() { focus.style("display", null); })
                            .on("mouseout", function() { focus.style("display", "none"); })
                            .on("mousemove", mousemove);

                        function mousemove() {
                            var x0 = Math.round(x.invert(d3.mouse(this)[0])); // Mouse X value
                            var y0 = y.invert(d3.mouse(this)[0]); // Mouse Y value

                            // Matrix Factorization Y Value
                            var d0 = data[x0 - 1]["ndcg"]; // X-1 Y Value
                            var d1 = data[x0]["ndcg"]; // Y Value

                            // Feature Matrix Factorization Y Value
                            var c0 = data[x0 - 1]["ndcg_feat"]; // X-1 Y Value
                            var c1 = data[x0]["ndcg_feat"]; // Y Value

                            var d = x0 - x0 - 1 > x0 - x0 ? d1 : d0;
                            var c = x0 - x0 - 1 > x0 - x0 ? c1 : c0;
                            focus.attr("transform", "translate(" + x(x0) + "," + y(d) + ")");

                            // Text Value Display
                            focus.select(".n_val").text("K: ".concat(x0));
                            focus.select(".mf_val").text("MF: ".concat(d.slice(0, 7)));
                            focus.select(".mf_feat_val").text("Feat MF: ".concat(c.slice(0, 7)));

                            // Hover lines
                            focus.select(".x-hover-line").attr("y2", height - y(d)); //510 - inverse current pixel height
                            focus.select(".y-hover-line2").attr("y2", height - y(c)); //510 - inverse current pixel height
                            // focus.select(".y-hover-line2").attr("x1", 0 - y(y0)); //x(c) - 930
                          }

                          });
                </script>
            </div>
        </main>

        <!-- Bootstrap core JavaScript -->
        <script src="/js/popper.js"></script>
        <script src="/js/bootstrap.js"></script>
    </body>
</html>
